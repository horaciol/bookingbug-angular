<div bb-page>

  <div bb-calendar-admin>

    <div class="page-header">
      <h1>Availability Conflict</h1>
    </div>

    <div class="page-summary">

      <p>
        There's an availability conflict <span ng-show="person_name">with {{person_name}}</span><span ng-show="resource_name">in {{resource_name}}</span>.
           <!--at {{bb.current_item.defaults.datetime | datetime: 'time'}} -->  This can be the result of: <!-- either the person or resouce requried already be booked/unavailable or that there's not enough to complete the service. You can r -->
      </p>

      <div class="row">
        <ul class="bb-bullet-list">
          <div class="col-sm-6 col-md-4">
            <li>The Staff/Resource being booked or blocked already</li>
          </div>
          <div class="col-sm-6 col-md-4">
            <li>Not enough available time to complete the booking before an existing one starts</li>
          </div>
          <div class="col-sm-6 col-md-4">
            <li>The selected time being outside of the {{bb.current_item.service.booking_time_step | time_period}} booking time step for {{bb.current_item.service.name}}.</li>
          </div>
        </ul>
      </div>

      <p>You can either use the calendar to choose another time or overbook.</p>

    </div>
      
    <div class="panel panel-default">
      <div class="panel-heading"><strong>Calendar</strong></div>
      <div class="panel-body">


        <div class="row">
          <div class="col-sm-6">

            <div class="form-inline">

              <div class="bb-filter-icon ">
                <span class="glyphicon glyphicon-filter" aria-hidden="true"></span> 
                Filter by:
              </div>

              <div class="form-group" ng-if="bb.company.$has('people')">
                <select bb-people class=" form-control" id="person" ng-model="person" ng-options="p.name for p in bookable_people | orderBy: 'name'" >
                  <option value="">Any person</option>
                </select>
              </div>

              <div class="form-group" ng-if="bb.company.$has('resources')">
                <select bb-resources class="form-control"  id="resource" ng-model="resource" ng-options="r.name for r in bookable_resources | orderBy: 'name'">
                  <option value="">-- select a resource --</option>
                </select>
              </div>


            </div>
          </div>

          <div class="col-sm-6">
            <div class="bb-view-switcher hidden-xs">
              <div class="btn-group pull-right">
                <button class="btn btn-sm btn-default" ng-class="{active: !week_view}" ng-click="switchView()">
                  <i class="fa fa-calendar-times-o"></i> Day
                </button>
                <button class="btn btn-sm btn-default" ng-class="{active: week_view}" ng-click="switchView()">
                  <i class="fa fa-calendar-o"></i> 
                  <span class="visible-sm-inline">3 day</span>
                  <span class="visible-md-inline">5 day</span>
                  <span class="visible-lg-inline">7 day</span>
                </button>
              </div>
            </div>
          </div>

        </div>

        <div ng-if="!week_view">

          <div class="bb-day-nav">

            <button type="button" class="btn btn-link btn-day-nav btn-lg" ng-click="subtract('days', 1)">
              <span class="glyphicon glyphicon-chevron-left"></span>
              <!-- <span class="hidden-xs">Previous</span> -->
            </button>

            <h2 class="hidden-xs bb-day-nav-heading">{{selected_date | datetime: 'Do MMMM YYYY'}}</h2>
            <h2 class="hidden-sm hidden-md hidden-lg bb-day-nav-heading">{{selected_date | datetime: 'Do MMMM'}}</h2>

            <button type="button" class="btn btn-link btn-day-nav btn-lg" ng-click="add('days', 1)">
              <span class="glyphicon glyphicon-chevron-right"></span>
              <!-- <span class="hidden-xs">Next</span> -->
            </button>

          </div>

          <div class="bb-calendar">

            <div ng-show="!slots || (slots && slots.length == 0)" class="bb-service-unavailable">
              <p>No availability found</p>
            </div>

            <div ng-if="slots">

              <div accordion close-others="false">

                <!-- Morning -->
                <div bb-accordian-range-group="{heading: 'Morning', range: [0, 720], slots: slots, collaspe_when_time_selected: true, day: selected_date}" ng-init="setFormDataStoreId($index)" class="accordian-group">
                </div>

                <!-- Afternoon -->
                <div bb-accordian-range-group="{heading: 'Afternoon', range: [720, 1020], slots: slots, collaspe_when_time_selected: true, day: selected_date}" ng-init="setFormDataStoreId($index)" class="accordian-group">
                </div>


                <!-- Evening -->
                <div bb-accordian-range-group="{heading: 'Evening', range: [1020, 1440], slots: slots, collaspe_when_time_selected: true, day: selected_date}" ng-init="setFormDataStoreId($index)" class="accordian-group">
                </div>

              </div>

            </div>

          </div>

        </div>

        <div ng-if="week_view">
          <div bb-time-ranges="{selected_day: today}"></div>
        </div>

        <button type="button" class="btn btn-primary pull-right" ng-click="checkReady() && routeReady()" bb-debounce ng-disabled="!bb.current_item.time">Book {{bb.current_item.start_datetime() | datetime: 'time'}}</button>

      </div>
    </div>

  
    <div class="panel panel-danger">
      <div class="panel-heading"><!-- Availability Conflict Detected --><strong>Overbook</strong></div>
      <div class="panel-body">

        <p>Overbooking ignores booking time step and availability constraints to make a booking.</p>
        
        <button type="button" class="btn btn-danger pull-right" ng-click="overBook()" bb-debounce>Overbook {{bb.current_item.defaults.datetime | datetime: 'time'}}</button>

      </div>

    </div>

  </div>

  <div class="bb-step-navigation">
    <div class="row">
      <div class="col-sm-9 col-sm-push-3 text-right">
        <!-- <button type="button" class="btn btn-primary" ng-click="checkReady() && routeReady()" bb-debounce>Continue</button> -->
      </div>
      <div class="col-sm-3 col-sm-pull-9">
        <button type="button" class="btn btn-default" bb-debounce ng-click="loadPreviousStep()" ng-show="bb.current_step > 1">Back</button>
      </div>
    </div>
  </div>

</div>
